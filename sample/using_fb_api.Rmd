---
title: "Working with Facebook Graph API and R"
author: "Ben McCary"  
date: '`r format(Sys.time(), "%B %d, %Y")`'
output: 
  html_document:
    keep_md: yes
---
    
# Using the Facebook Graph API in R Tool  

Note, key is expired in committed version. Use the following technique to get token/user ignored by git filter:

http://stackoverflow.com/questions/16244969/how-to-tell-git-to-ignore-individual-lines-i-e-gitignore-for-specific-lines-of

```{r promts}
#navigates to website
browseURL('https://developers.facebook.com/tools/explorer/')
# try to make something that prompts you for parameters
# INCLUDE:
# 1. date (since, until)
# 2. metric
# 3. period
params <- c("metric=page_impressions_by_age_gender_unique","since=2016-06-1", "until=2016-06-30", "period=day")
token <- readline("What is your page token? ")
user <- readline("What is your page username or id? ")
```

```{r sourcing}
source("../fb_api.R")
source("../fb_matrix.R")
```


## Getting the data:

```{r data}
token <- "EAACEdEose0cBAHZBqNuTk5XJgCMj4cPBR48sawrLmME1cOjgCLyo71IZCaV1hZB7Q9oVvq8JmkhkkBg13ZBuOAmBGyTnQ1v1quA5ypfYlrcFu6Uyh5vNuwUQKiZC9Dc9GcZAsregezfT9JVbDeUF5Kalpskr1EqWQe14fP03ovZAAZDZD"
user <- "662428190454349"
dat <- fb.api(user, token, params)
test <- fb.matrix(dat)
```
## Doing some analysis  
figure out how to make the x-axis all fit. Maybe skip ever other day or something.

```{r plots, fig.width=10}
# reorganize matrix to be usable by ggplot
require(ggplot2)
require(reshape2)
g2 <- ggplot(test, aes(index, F.25.34, group=1))+geom_point()+geom_line()
g2
g <- ggplot(melt(test), aes(x=index, y=value, col=variable, group=variable))+geom_line()
g



require(dplyr)
m <- melt(test)
m2 <- filter(m, variable%in%c("F.25.34","M.25.34"))
g3 <- ggplot(m2, aes(x=index, y=value, col=variable, group=variable))+geom_line()+geom_smooth(method = "lm", se = F)
g3
```


## First stab at a linear model
```{r lm}
test2 <- test
test2$index <- as.Date(test2$index)
plot(M.25.34~index, data = test2)
fit <- lm(M.25.34~index, test2)
abline(fit)
# 

fit2 <- lm(F.25.34~., data=test2)
summary(fit2)$coef

```

Note that only Males age 25-34 are the only of the coefficients that are pertinent to the model. Perhaps a Poisson GLM would be better suited for this analysis.